/*	Copyright 2001 Dan Simpson under the MIT License <http://www.opensource.org/licenses/mit-license.php> */
(function(){var b,a,f,e,k,j,i;var g=function(l,m){return function(){return l.apply(m,arguments)}},d=Array.prototype.slice,h=Object.prototype.hasOwnProperty,c=function(o,m){for(var l in m){if(h.call(m,l)){o[l]=m[l]}}function n(){this.constructor=o}n.prototype=m.prototype;o.prototype=new n;o.__super__=m.prototype;return o};b=(function(){function l(m,n){this.name=m;this.transport=n;this.events={"*":[]};this.filters=[];this.subscribe()}l.prototype.on=function(n,m){if(!this.events[n]){this.events[n]=[]}this.events[n].push(m);return this};l.prototype.process=function(p,A,w){var y,q,n,u,v,t,s,z,o,m,x,r;y={event:p,data:A,user:w};if(this.filters.length>0){x=this.filters;for(v=0,z=x.length;v<z;v++){q=x[v];y=q(y);if(y===false){return this}}}if(p!=="*"){u=this.events[p];if(u){for(t=0,o=u.length;t<o;t++){n=u[t];n(y)}}}r=this.events["*"];for(s=0,m=r.length;s<m;s++){n=r[s];n(y)}return this};l.prototype.broadcast=function(n,m){return this.transport.send({event:n,channel:this.name,data:m})};l.prototype.unsubscribe=function(){return this.transport.send({event:"$unsubscribe",channel:this.name})};l.prototype.subscribe=function(){return this.transport.send({event:"$subscribe",channel:this.name})};l.prototype.filter=function(m){this.filters.push(m);return this};return l})();a=(function(){function l(){this.transport=null;this.url=null;this.channels={};this.network=null;this.events={};this.id=null;this.debugMode=false;this.secure=false}l.prototype.connect=function(m){this.network=m;if(!(this.transport&&this.transport.connected)){if(window.WebSocket===void 0){this.transport=new f(this.network,this.secure)}else{this.transport=new k(this.network,this.secure)}this.transport.on("message",g(function(){return this._process.apply(this,arguments)},this));this.transport.on("connect",g(function(){return this._dispatch("connect")},this));this.transport.on("connecting",g(function(){return this._dispatch("connecting")},this));this.transport.on("reconnect",g(function(){return this._reconnect()},this));this.transport.on("disconnect",g(function(){return this._dispatch("disconnect")},this));this.transport.connect()}return this};l.prototype.disconnect=function(){this.transport.disconnect();return this};l.prototype.channel=function(m){if(!this.channels[m]){this.channels[m]=new b(m,this.transport)}return this.channels[m]};l.prototype.on=function(n,m){if(!this.events[n]){this.events[n]=[]}this.events[n].push(m);return this};l.prototype.identity=function(){return this.id};l.prototype.debug=function(m){this.debugMode=m||true;return this};l.prototype.direct=function(m,o,n){this.transport.send({event:o,to:m,data:n});return this};l.prototype._process=function(m){if(m.channel){if(this.channels[m.channel]){return this.channels[m.channel].process(m.event,m.data,m.from)}else{}}else{if(m.event==="$error"){return this._dispatch("error",m.data)}else{if(m.event==="$identity"){this.id=m.data;return this._dispatch("identity",this.id)}else{return console.error("Unrecognized frame",m)}}}};l.prototype._dispatch=function(){var n,r,o,q,m,p;o=arguments[0],n=2<=arguments.length?d.call(arguments,1):[];if(this.events[o]){p=this.events[o];for(q=0,m=p.length;q<m;q++){r=p[q];r.apply(window,n)}}return this};l.prototype._reconnect=function(){var n,m,o;o=this.channels;for(m in o){n=o[m];n.subscribe()}return this._dispatch("reconnect")};return l})();window.Shove=new a();if(window.jQuery){$(function(){return $.shove=window.Shove})}(function(){var l;l=window.console;if(!(l&&l.log&&l.error)){return l={log:function(){},error:function(){}}}})();j=(function(){var l,m;l=["dev","dev1"];m=0;return function(){return l[m++%l.length]}})();i=["connect","connecting","disconnect","message","reconnect","error"];e=(function(){function l(){this.queue=[];this.connected=false;this.callbacks={};this.connections=0;this.forcedc=false}l.prototype.on=function(n,m){if(i.indexOf(n)===-1){return console.error("Unknow event "+n+".  Valid events: "+(i.join(", ")))}else{if(!this.callbacks[n]){this.callbacks[n]=[]}return this.callbacks[n].push(m)}};l.prototype.connect=function(){return console.error("abstract method connect called on transport")};l.prototype.disconnect=function(){return console.error("abstract method disconnect called on transport")};l.prototype.send=function(m){if(!this.connected){this.queue.push(m)}else{this._send(this._encode(m))}return this};l.prototype._dispatch=function(){var n,r,o,q,m,p;o=arguments[0],n=2<=arguments.length?d.call(arguments,1):[];if(this.callbacks[o]){p=this.callbacks[o];for(q=0,m=p.length;q<m;q++){r=p[q];r.apply(window,n)}}return this};l.prototype._process=function(m){return this._dispatch("message",this._decode(m.data))};l.prototype._connected=function(m){this.connected=true;this.connections++;if(this.connections>1){this._dispatch("reconnect")}else{this._dispatch("connect")}while(this.queue.length>0){this.send(this.queue.shift())}return this};l.prototype._disconnected=function(){this.connected=false;this._dispatch("disconnect");if(!this.forcedc){setTimeout((g(function(){return this.connect},this)),5000)}return this};l.prototype._send=function(m){return console.error("Transport does not support sending frames.")};l.prototype._decode=function(r){var q,o,n,m,p;m={};n=r.length;o=0;q=0;p=0;while(q<n){if(r[q]==="!"){if(o===0){m.channel=r.substring(p,q)}else{if(o===1){m.event=r.substring(p,q)}else{if(o===2){m.to=r.substring(p,q)}else{m.from=r.substring(p,q);m.data=r.substring(q+1,n);break}}}o++;p=q+1}q++}return m};l.prototype._encode=function(m){return""+m.channel+"!"+m.event+"!"+(m.to||"")+"!!"+(m.data||"")};return l})();k=(function(){c(l,e);function l(m,n){this.network=m;this.secure=n;l.__super__.constructor.apply(this,arguments)}l.prototype.connect=function(){this._dispatch("connecting");this.socket=new WebSocket(""+(this.secure?"wss":"ws")+"://ws-"+(j())+".shove.io/"+this.network);this.socket.onclose=g(function(){return this._disconnected()},this);this.socket.onmessage=g(function(m){return this._process(m)},this);this.socket.onopen=g(function(){return this._connected()},this);return this.forcedc=false};l.prototype.disconnect=function(){this.forcedc=true;return this.socket.close()};l.prototype._send=function(m){return this.socket.send(m)};return l})();f=(function(){c(l,e);function l(m,n){this.network=m;this.secure=n;l.__super__.constructor.apply(this,arguments);this.seed=1;this.started=null;this.requesting=false;this.timeout=10000;this.timer=null;window._scb=g(function(o){return this.onLoad(o)},this)}l.prototype.connect=function(){this.url=""+(this.secure?"https":"http")+"://poll-"+(j())+".shove.io/"+this.network;return this.request()};l.prototype.request=function(m){clearTimeout(this.timer);this.timer=setTimeout((g(function(){return this.onTimeout()},this)),this.timeout);return this.addTag(this.getUrl())};l.prototype.addTag=function(n){var m;m=document.createElement("script");m.setAttribute("src",n);m.setAttribute("type","text/javascript");m.setAttribute("id","comet"+this.seed);return document.getElementsByTagName("head")[0].appendChild(m)};l.prototype.removeTag=function(){return document.getElementsByTagName("head")[0].removeChild(document.getElementById("comet"+(this.seed++)))};l.prototype.getUrl=function(){var m;m="/"+Math.random();if(this.queue.length>0){m+="/"+this.queue.shift()}return""+this.url+m};l.prototype.onLoad=function(m){if(m==="connect"){this._connected()}else{this._process({data:m})}clearTimeout(this.timer);return this.timer=setTimeout((g(function(){return this.request()},this)),20)};l.prototype.onTimeout=function(){this.removeTag();return this.request()};l.prototype.send=function(m){this.removeTag();return this.request(m)};return l})();(function(){var l,n,m;if(!window.WebSocket){document.write('<div id="wsproxy">Loading</div>');if(!swfobject.hasFlashPlayerVersion("9.0.0")){console.error("Flash Player >= 9.0.0 is required.");return}if(location.protocol==="file:"){m="HEYHEYHEY: shove flash fallback does NOT work in file:///... URL      unless you set Flash Security Settings properly.        Open the page via Web server i.e. http://...";console.error(m)}n={queue:[],proxy:null,socket:null,ready:function(){this.proxy=document.getElementById("wsproxy");while(this.queue.length>0){this.queue.shift.call(this)}return this},onload:function(o){if(console&&console.log){console.log(o)}return this},register:function(o){if(this.proxy===null){this.queue.push(g(function(){return this.register(o)},this))}else{this.socket=o;this.proxy.open(o.uri)}return this},send:function(o){if(this.proxy===null){this.queue.push(g(function(){return this.send(o)},this))}else{this.proxy.send(o)}return this},onopen:function(){this.socket.onopen({});return this},onmessage:function(o){this.socket.onmessage({data:o});return this},onclose:function(){this.socket.onclose({});return this}};l=(function(){function o(p){this.uri=p;n.register(this)}o.prototype.send=function(p){return n.send(p)};return o})();return swfobject.embedSWF("http://static-dev.shove.io/a01/proxy.swf","wsproxy","1","1","9.0.0","",{},{allowscriptaccess:"always",allownetworking:"all"})}})()}).call(this);